# ギャップ分析と開発計画

**作成日**: 2025-12-23
**バージョン**: 1.0

---

## 📊 実装状況サマリー

### 実装済み機能 (✅)
- プロジェクトセットアップ（React + TypeScript + Node.js + Express）
- Monorepoアーキテクチャ（npm workspaces）
- メンバー管理CRUD
- 関係性管理CRUD
- グループ管理CRUD（仮想グループ機能）
- 基本的なネットワークグラフ表示（Cytoscape.js）
- リアルタイム同期（Socket.io）
- **複数マップサポート**（要件外の追加機能）
- InMemoryStorage（MVP用）
- TypeScript完全対応
- 基本的なセキュリティ（helmet, cors, rate-limit）

### 実装進捗率
**全体進捗: 約40%**
- コア機能（データ管理・可視化）: 60%
- 分析機能: 0%
- 認証・セキュリティ: 10%
- デプロイメント: 0%

---

## 🔍 詳細ギャップ分析

### 1. 認証・セキュリティ（優先度: 高）

| 機能 | 要件 | 現状 | ギャップ |
|------|------|------|---------|
| Google SSO | 必須 | ❌ 未実装 | Google OAuth 2.0実装必要 |
| Azure AD | オプション | ❌ 未実装 | Passport.js統合必要 |
| JWT管理 | 必須 | ❌ 未実装 | セッション管理実装必要 |
| 認証ミドルウェア | 必須 | ❌ 未実装 | 保護されたルート実装必要 |
| HTTPS | 必須 | ⚠️ 開発環境のみ | 本番環境設定必要 |

**影響**: データアクセス制御が不十分。本番環境での利用不可。

---

### 2. データベース（優先度: 高）

| 機能 | 要件 | 現状 | ギャップ |
|------|------|------|---------|
| Firestore移行 | 推奨 | ❌ 未実装 | データ永続化層の実装必要 |
| データ永続化 | 必須 | ❌ InMemoryのみ | サーバー再起動でデータ消失 |
| バックアップ | 必須 | ❌ 未実装 | 日次バックアップ設定必要 |

**影響**: データの永続性なし。本番環境での利用不可。

---

### 3. 可視化機能の詳細（優先度: 中）

| 機能 | 要件 | 現状 | ギャップ |
|------|------|------|---------|
| ノードサイズ変更 | 影響力に応じて | ❌ 固定サイズ | 中心性計算＋スタイル適用必要 |
| ノードの色分け | 部署/コミュニティ | ⚠️ グループのみ | 部署・コミュニティ自動色分け必要 |
| エッジの太さ | 関係強度 | ❌ 固定 | strength値をスタイルに反映必要 |
| エッジの色/スタイル | 関係種類 | ❌ 固定 | type値をスタイルに反映必要 |
| ホバー情報 | 詳細表示 | ❌ なし | Tooltipコンポーネント実装必要 |
| ズーム・パン | あり | ✅ 実装済み | - |
| ドラッグ移動 | あり | ✅ 実装済み | - |

**影響**: ユーザビリティが低い。データの意味が直感的に伝わらない。

---

### 4. フィルタリング・検索（優先度: 中）

| 機能 | 要件 | 現状 | ギャップ |
|------|------|------|---------|
| メンバー名検索 | 必須 | ❌ 未実装 | 検索UIとフィルタ機能実装必要 |
| 部署フィルタ | 必須 | ❌ 未実装 | フィルタUIとロジック実装必要 |
| 関係性種類フィルタ | 必須 | ❌ 未実装 | フィルタUIとロジック実装必要 |
| 関係強度フィルタ | 必須 | ❌ 未実装 | スライダーUIと実装必要 |

**影響**: 大規模データでの使いにくさ。特定情報の探索困難。

---

### 5. 分析機能（優先度: 高）

| 機能 | 要件 | 現状 | ギャップ |
|------|------|------|---------|
| コミュニティ検出 | 必須（Louvain等） | ❌ 未実装 | アルゴリズム実装＋API必要 |
| 統計情報表示 | 必須 | ⚠️ 基本のみ | 詳細統計パネル実装必要 |
| 孤立メンバー検出 | 必須 | ❌ 未実装 | グラフアルゴリズム実装必要 |
| 中心性分析 | オプション | ❌ 未実装 | PageRank等の実装必要 |
| データエクスポート | オプション | ❌ 未実装 | CSV/JSON出力機能必要 |

**影響**: コアバリューの大部分が未実装。分析ツールとして機能不足。

---

### 6. UI/UX（優先度: 中）

| 機能 | 要件 | 現状 | ギャップ |
|------|------|------|---------|
| レスポンシブ対応 | デスクトップ優先 | ⚠️ 部分対応 | タブレット・モバイル最適化必要 |
| 統計パネル | 折りたたみ可能 | ❌ 未実装 | パネルコンポーネント実装必要 |
| ローディング状態 | 必須 | ✅ 実装済み | - |
| エラーハンドリング | 必須 | ⚠️ 基本のみ | ユーザーフレンドリーなエラー表示必要 |

**影響**: 特定デバイスでの使いにくさ。

---

### 7. デプロイメント・DevOps（優先度: 高）

| 機能 | 要件 | 現状 | ギャップ |
|------|------|------|---------|
| PaaSデプロイ | Vercel/Render等 | ❌ 未実装 | デプロイ設定・環境構築必要 |
| CI/CD | 推奨 | ❌ 未実装 | GitHub Actions設定必要 |
| 環境変数管理 | 必須 | ⚠️ .env.example | 各環境の設定必要 |
| モニタリング | 推奨 | ❌ 未実装 | ログ・エラー監視設定必要 |

**影響**: 本番環境での運用不可。

---

### 8. テスト（優先度: 中）

| 機能 | 要件 | 現状 | ギャップ |
|------|------|------|---------|
| ユニットテスト | 70%カバレッジ目標 | ❌ 0% | Jest設定＋テスト実装必要 |
| E2Eテスト | 推奨 | ❌ 未実装 | Playwright/Cypress設定必要 |
| API統合テスト | 推奨 | ❌ 未実装 | Supertest実装必要 |

**影響**: 品質保証が不十分。リグレッション検出困難。

---

## 📋 優先順位付き開発計画

### Phase 1: データ永続化と認証（最重要）
**期間**: 2-3週間
**目標**: 本番環境で利用可能な状態にする

#### 1.1 データベース移行（Week 1-2）
- [ ] Firestore/MongoDB選定と環境構築
- [ ] データモデル設計（マイグレーション戦略）
- [ ] Repository層実装
- [ ] InMemoryStorageからの移行
- [ ] データバックアップ設定

#### 1.2 認証機能実装（Week 2-3）
- [ ] Google OAuth 2.0統合
- [ ] Firebase Authentication または Passport.js選定
- [ ] JWTトークン発行・検証
- [ ] 認証ミドルウェア実装
- [ ] 保護されたAPIルート設定
- [ ] ログイン/ログアウトUI実装

#### 1.3 デプロイメント準備（Week 3）
- [ ] Vercel/Render環境構築
- [ ] 環境変数設定（本番/ステージング）
- [ ] HTTPS設定
- [ ] ドメイン設定（必要に応じて）

---

### Phase 2: 分析機能実装（高優先）
**期間**: 2-3週間
**目標**: コアバリューの提供

#### 2.1 コミュニティ検出（Week 1-2）
- [ ] graphologyライブラリ統合
- [ ] Louvain法アルゴリズム実装
- [ ] コミュニティ検出API (`POST /api/analysis/communities/refresh`)
- [ ] コミュニティ取得API (`GET /api/analysis/communities`)
- [ ] コミュニティ結果の永続化
- [ ] グラフへのコミュニティ色分け反映

#### 2.2 グラフ分析アルゴリズム（Week 2-3）
- [ ] 次数中心性計算
- [ ] 媒介中心性計算
- [ ] PageRank計算（オプション）
- [ ] 孤立ノード検出
- [ ] ノードサイズへの反映

#### 2.3 統計情報拡張（Week 3）
- [ ] 詳細統計パネル実装
- [ ] コミュニティごとの統計
- [ ] 影響力ランキング表示
- [ ] 折りたたみ可能なUI

---

### Phase 3: 可視化とUX改善（中優先）
**期間**: 1-2週間
**目標**: ユーザビリティ向上

#### 3.1 グラフ可視化の強化（Week 1）
- [ ] エッジの太さ（関係強度）反映
- [ ] エッジの色/スタイル（関係種類）反映
- [ ] ノードサイズ（影響力）反映
- [ ] ノードの色分け（部署/コミュニティ）
- [ ] ホバー時のTooltip表示
- [ ] アニメーション改善

#### 3.2 フィルタリング・検索（Week 1-2）
- [ ] 検索バーコンポーネント実装
- [ ] メンバー名インクリメンタル検索
- [ ] 部署フィルタUI実装
- [ ] 関係性種類フィルタUI実装
- [ ] 関係強度スライダー実装
- [ ] フィルタ適用時のグラフ更新

#### 3.3 レスポンシブ対応（Week 2）
- [ ] タブレット表示最適化
- [ ] モバイル閲覧モード実装
- [ ] サイドバーの折りたたみ機能

---

### Phase 4: 品質向上とCI/CD（中優先）
**期間**: 1-2週間
**目標**: 開発効率とコード品質の向上

#### 4.1 テスト実装（Week 1）
- [ ] Jest環境構築
- [ ] バックエンドユニットテスト実装
  - [ ] Services層テスト
  - [ ] Controllers層テスト
- [ ] フロントエンドユニットテスト実装
  - [ ] Hooksテスト
  - [ ] Componentsテスト
- [ ] 目標カバレッジ: 50%以上

#### 4.2 CI/CD構築（Week 1-2）
- [ ] GitHub Actions設定
- [ ] 自動テスト実行
- [ ] 自動デプロイ（main/developブランチ）
- [ ] コードフォーマット・Lint自動チェック
- [ ] Pre-commit hooks設定

#### 4.3 モニタリング（Week 2）
- [ ] エラートラッキング（Sentry等）
- [ ] パフォーマンスモニタリング
- [ ] ログ集約設定

---

### Phase 5: 拡張機能（低優先/オプション）
**期間**: 2-3週間
**目標**: 付加価値の提供

#### 5.1 データエクスポート
- [ ] CSV出力機能
- [ ] JSON出力機能
- [ ] 画像エクスポート（PNG/SVG）

#### 5.2 時系列分析（オプション）
- [ ] 関係性の履歴記録
- [ ] 時系列グラフ表示
- [ ] 変化の可視化

#### 5.3 外部ツール連携（オプション）
- [ ] Slack通知連携
- [ ] GitHub連携（コミット情報から関係性推測）
- [ ] Google Workspace連携（組織情報同期）

---

## 🎯 マイルストーン

### M1: 本番運用可能（Phase 1完了）
**期間**: 3週間
**成果物**:
- データ永続化済み
- 認証機能完備
- PaaS環境デプロイ済み

### M2: 分析機能提供（Phase 2完了）
**期間**: 累計6週間
**成果物**:
- コミュニティ検出機能
- 影響力分析機能
- 統計情報ダッシュボード

### M3: 高度なUX提供（Phase 3完了）
**期間**: 累計8週間
**成果物**:
- フィルタリング・検索完備
- レスポンシブ対応
- 洗練されたグラフ可視化

### M4: 高品質な開発体制（Phase 4完了）
**期間**: 累計10週間
**成果物**:
- テストカバレッジ50%以上
- CI/CD完備
- モニタリング体制構築

---

## ⚠️ 技術的負債とリスク

### 現在の技術的負債
1. **InMemoryStorage**: サーバー再起動でデータ消失
2. **認証なし**: セキュリティリスク大
3. **テストなし**: リグレッションリスク
4. **環境分離不十分**: 開発環境のみ

### 主要リスク
| リスク | 確率 | 影響 | 対策 |
|--------|------|------|------|
| Firestore移行の複雑性 | 中 | 高 | 段階的移行、データマイグレーション計画 |
| OAuth統合のトラブル | 中 | 中 | 詳細なドキュメント、フォールバック機能 |
| グラフパフォーマンス問題 | 高 | 中 | 仮想化、WebGL検討、データページング |
| スコープクリープ | 中 | 中 | MVP優先、フェーズ分割厳守 |

---

## 📊 成功基準（再確認）

### Phase 1完了時
- [ ] 50人のデータを安全に永続化
- [ ] Google SSOでログイン可能
- [ ] PaaS環境で稼働
- [ ] データバックアップ機能

### Phase 2完了時
- [ ] コミュニティ検出が実用的な結果を返す
- [ ] 影響力の大きいメンバーを特定可能
- [ ] 統計情報が有用

### Phase 3完了時
- [ ] 50人のデータを快適に表示・操作
- [ ] 直感的なフィルタリング機能
- [ ] タブレット対応完了

### Phase 4完了時
- [ ] テストカバレッジ50%以上
- [ ] 自動デプロイ機能
- [ ] エラー監視体制

---

## 📝 推奨アクション（今すぐ）

### 即時対応が必要な項目
1. **データベース選定会議**: Firestore vs MongoDB
2. **認証方式確定**: Google OAuth vs Azure AD vs Firebase Auth
3. **PaaSプロバイダー選定**: Vercel vs Netlify / Render vs Railway
4. **開発スケジュール策定**: リソース・期限確認

### 今週中に着手すべき項目
1. Firestore環境構築
2. データモデル設計
3. Firebase AuthenticationまたはPassport.js統合開始
4. CI/CD基本設定

---

**次回レビュー予定**: Phase 1完了時（約3週間後）
